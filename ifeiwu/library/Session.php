<?php
namespace ifeiwu; class Session { private $prefix = ''; private static $_instance; public static function getInstance($config = array()) { if (!(self::$_instance instanceof self)) { self::$_instance = new self($config); } return self::$_instance; } private function __construct($config) { $config = array_merge(Config::get('session'), $config); $this->prefix = $config['prefix']; if (isset($config['id'])) { session_id($config['id']); } if (isset($config['name'])) { session_name($config['name']); } if (isset($config['path'])) { session_save_path($config['path']); } if (isset($config['domain'])) { ini_set('session.cookie_domain', $config['domain']); } if (isset($config['expire'])) { ini_set('session.gc_maxlifetime', $config['expire']); ini_set('session.cookie_lifetime', $config['expire']); } if (isset($config['use_cookies'])) { ini_set('session.use_cookies', $config['use_cookies'] ? 1 : 0); } session_start(); } public static function prefix($prefix) { $this->prefix = $prefix; } public function set($name, $value = '', $prefix = null) { $prefix = $prefix ? : $this->prefix; if (strpos($name, '.')) { list($name1, $name2) = explode('.', $name); if ($prefix) { $_SESSION[$prefix][$name1][$name2] = $value; } else { $_SESSION[$name1][$name2] = $value; } } elseif ($prefix) { $_SESSION[$prefix][$name] = $value; } else { $_SESSION[$name] = $value; } } public function get($name = '', $prefix = null) { $prefix = $prefix ? : $this->prefix; if ($name == '') { $value = $prefix ? (!empty($_SESSION[$prefix]) ? $_SESSION[$prefix] : array()) : $_SESSION; } elseif ($prefix) { if (strpos($name, '.')) { list($name1, $name2) = explode('.', $name); $value = isset($_SESSION[$prefix][$name1][$name2]) ? $_SESSION[$prefix][$name1][$name2] : null; } else { $value = isset($_SESSION[$prefix][$name]) ? $_SESSION[$prefix][$name] : null; } } else { if (strpos($name, '.')) { list($name1, $name2) = explode('.', $name); $value = isset($_SESSION[$name1][$name2]) ? $_SESSION[$name1][$name2] : null; } else { $value = isset($_SESSION[$name]) ? $_SESSION[$name] : null; } } return $value; } public function delete($name, $prefix = null) { $prefix = $prefix ? : $this->prefix; if (strpos($name, '.')) { list($name1, $name2) = explode('.', $name); if ($prefix) { unset($_SESSION[$prefix][$name1][$name2]); } else { unset($_SESSION[$name1][$name2]); } } else { if ($prefix) { unset($_SESSION[$prefix][$name]); } else { unset($_SESSION[$name]); } } } public function has($name, $prefix = null) { $prefix = $prefix ? : $this->prefix; if (strpos($name, '.')) { list($name1, $name2) = explode('.', $name); return $prefix ? isset($_SESSION[$prefix][$name1][$name2]) : isset($_SESSION[$name1][$name2]); } else { return $prefix ? isset($_SESSION[$prefix][$name]) : isset($_SESSION[$name]); } } public function clear($prefix = null) { $prefix = $prefix ? $prefix : $this->prefix; if ($prefix) { unset($_SESSION[$prefix]); } else { $_SESSION = array(); } } public static function destroy() { $_SESSION = array(); session_unset(); session_destroy(); } } 