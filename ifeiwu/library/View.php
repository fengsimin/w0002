<?php
namespace ifeiwu; class View { protected $vars = array(); protected $layout; protected $theme; protected $request; protected $response; public function __construct($request, $response) { $this->request = $request; $this->response = $response; } public function __get($name) { return $this->vars[$name]; } public function __set($name, $value = '') { $this->vars[$name] = $value; } public function assign($name, $value = '') { if (is_array($name)) { $this->vars = array_merge($this->vars, $name); } else { $this->vars[$name] = $value; } } public function fetch($template, $vars = array()) { if ($vars) { $this->vars = array_merge($this->vars, $vars); } ob_start(); ob_implicit_flush(0); extract($this->vars, EXTR_OVERWRITE); $template = 'view/' . $template . '.php'; is_file($template) ? include $template : eval('?>' . $template); $content = ob_get_clean(); return $content; } public function theme($name) { $this->theme = $name . '/'; } public function layout($name, $theme = '') { $theme = $theme ? $theme : $this->theme; $this->theme = $theme ? $theme . '/' : ''; if ($name === true) { $this->layout = $this->theme . 'layout'; } elseif ($name === false) { $this->layout = false; } else { $this->layout = $this->theme . $name; } } public function display($name, $vars = array()) { if (!$name) { $name = $this->request->action(); } $content = $this->fetch($this->theme . $name, $vars); if ($this->layout) { echo str_replace('{__CONTENT__}', $content, $this->fetch($this->layout, $vars)); } else { echo $content; } } public function url($url = '', $version = '') { if (preg_match('/^(http:\/\/|https:\/\/).*$/', $url)) { return $url; } $url = $this->request->root() . $url; if (preg_match('/\.(jpg|jpeg|bmp|png|gif|svg|ico|css|js)$/i', $url)) { if (!$version) { $version = $this->vars['site']['version']; } $url .= '?v=' . $version; } return $url; } public function encode($value) { return htmlspecialchars($value, ENT_QUOTES); } public function decode($value) { return htmlspecialchars_decode($value, ENT_QUOTES); } } 