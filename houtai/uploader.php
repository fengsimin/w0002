<?php
//Copyright (c) 2016 iFeiwu.com
 class Uploader extends Ifeiwu { function __construct() { } protected function postImage($request_data) { goto Yynyw; Vr4NZ: $file_new_name_body = $_POST["\146\x69\154\x65\x5f\156\x65\x77\x5f\x6e\x61\x6d\x65\137\x62\x6f\x64\171"]; goto Tq6vx; xEuF7: $image_resize = $_POST["\151\x6d\141\x67\x65\137\162\x65\x73\151\x7a\x65"]; goto X2w5J; NLqf6: $image_y = explode("\x2c", $_POST["\x69\x6d\141\x67\x65\137\171"]); goto a0ORx; zF9Vd: $handle = new Upload($_FILES["\x66\x69\154\x65"]); goto n6hoT; B_Dou: goto DzEhw; goto Wyx7T; rsIGy: F1HVD: goto g0176; MyUzv: if (!$image_convert) { goto Tj9pD; } goto dXIgb; QCj_w: gkbye: goto Oar2T; a0ORx: foreach ($file_name_body_pre as $key => $prefix) { goto w7YgM; oP4XT: VhhsH: goto ByKgq; fy3sq: $handle->file_name_body_pre = $prefix; goto MWI6m; vVPIt: $handle->file_overwrite = $file_overwrite ? true : false; goto fKtow; MWI6m: EdnPb: goto q9H9E; QKZo4: fCoJV: goto PUXfo; hhWlB: $handle->image_resize = $image_resize ? true : false; goto fy3sq; zdcoJ: qdMK1: goto KWCxk; moW_u: jSyj3: goto DuGjW; KWCxk: if (!$image_convert) { goto IR_CQ; } goto mjPJk; vPnXP: if (!$prefix) { goto EdnPb; } goto hhWlB; A_sI5: IR_CQ: goto PN8CN; mjPJk: $handle->image_convert = $image_convert; goto A_sI5; yD4aJ: $height = $image_y[$key]; goto Oeg40; ByKgq: if (!$file_new_name_body) { goto ckkQR; } goto klhy4; kTBdX: $handle->image_x = $handle->image_src_x; goto xWeBE; DuGjW: if ($height && $handle->image_src_y > $height) { goto BbcbM; } goto JyKaD; PN8CN: if ($width && $handle->image_src_x > $width) { goto fCoJV; } goto kTBdX; q9H9E: if (!$quality) { goto qdMK1; } goto KyYlj; fKtow: $handle->Process($upload_root . "\x2f" . $file_save_path); goto xONF0; PUXfo: $handle->image_x = $width; goto moW_u; LrgyA: $handle->image_y = $height; goto oP4XT; e1u8d: BbcbM: goto LrgyA; JyKaD: $handle->image_ratio_y = true; goto ew3Vy; ew3Vy: goto VhhsH; goto e1u8d; eEpyG: ckkQR: goto vVPIt; xWeBE: goto jSyj3; goto QKZo4; KyYlj: $handle->jpeg_quality = $quality; goto zdcoJ; Oeg40: $quality = $jpeg_quality[$key]; goto vPnXP; xONF0: QKy3f: goto Kwaqv; klhy4: $handle->file_new_name_body = $file_new_name_body; goto eEpyG; w7YgM: $width = $image_x[$key]; goto yD4aJ; Kwaqv: } goto wP2ZL; g0176: return $this->success('', array("\160\x61\164\150" => $file_save_path, "\x69\155\141\147\x65" => $handle->file_dst_name, "\163\151\x7a\145" => $handle->file_src_size, "\167\x69\144\x74\x68" => $handle->image_src_x, "\x68\145\x69\147\150\164" => $handle->image_src_y, "\164\171\160\x65" => $handle->image_dst_type, "\x65\170\164" => $handle->file_dst_name_ext)); goto l8L6V; Q4grf: dAHsK: goto RSebp; LOvX9: Tj9pD: goto cQuvm; yft2x: $file_save_path = ''; goto rsIGy; BP7jx: $jpeg_quality = explode("\54", $_POST["\152\160\145\x67\137\161\x75\141\x6c\x69\164\171"]); goto m1rPO; oWVJn: $handle->Process($upload_root . "\57" . $file_save_path); goto B_Dou; Wd1WT: $handle->jpeg_quality = $quality; goto HJM2V; cuwnW: $handle->file_new_name_body = $file_new_name_body; goto QCj_w; cQuvm: if (!$file_new_name_body) { goto gkbye; } goto cuwnW; Wyx7T: QnM3y: goto LgJEe; vCkjK: $image_convert = $_POST["\151\155\x61\x67\145\x5f\143\157\156\x76\x65\162\x74"]; goto BP7jx; Oar2T: $handle->file_overwrite = $file_overwrite ? true : false; goto oWVJn; UtnOB: return $this->error($handle->log); goto OJEHY; dTv3r: if ($handle->processed) { goto dAHsK; } goto UtnOB; HJM2V: XA9dh: goto MyUzv; XfIlS: $_FILES["\x66\x69\x6c\145"]["\145\x72\x72\157\162"] = $_POST["\x66\151\x6c\145\137\x65\x72\x72\157\162"]; goto stx1a; LgJEe: $file_name_body_pre = explode("\x2c", $_POST["\146\151\154\x65\x5f\x6e\141\x6d\x65\137\x62\x6f\144\x79\x5f\x70\x72\x65"]); goto F0MaL; Cs_kk: $quality = end($jpeg_quality); goto FfRYV; OJEHY: goto DOVoJ; goto Q4grf; Tq6vx: $file_overwrite = $_POST["\x66\x69\x6c\x65\x5f\x6f\x76\x65\162\x77\162\151\164\145"]; goto xEuF7; m1rPO: if ($image_resize == 1) { goto QnM3y; } goto Cs_kk; iBDCu: $upload_root = "\x2e\x2e\57"; goto Vr4NZ; u02uG: bb3AE: goto ix1sH; slb2y: qLJlo: goto dTv3r; iEN2a: DzEhw: goto slb2y; F0MaL: $image_x = explode("\x2c", $_POST["\x69\x6d\141\147\x65\x5f\170"]); goto NLqf6; X2w5J: $file_save_path = $_POST["\x66\x69\154\x65\137\x73\x61\x76\x65\137\x70\x61\164\x68"]; goto vCkjK; ix1sH: ifeiwu\Loader::import("\145\x78\164\x65\156\144\57\x55\160\154\157\141\x64"); goto zF9Vd; FfRYV: if (!$quality) { goto XA9dh; } goto Wd1WT; n6hoT: if (!$handle->uploaded) { goto qLJlo; } goto iBDCu; l8L6V: DOVoJ: goto bIbS7; Y0pfl: goto xDJUj; goto u02uG; RSebp: if (!($file_save_path == "\x2f")) { goto F1HVD; } goto yft2x; x1ARR: return $this->error("\xe6\x97\xa0\xe6\x95\210\xe7\x9a\204\346\226\207\xe4\273\xb6\xe4\xbf\241\346\x81\xaf\xef\xbc\x81"); goto Y0pfl; stx1a: if (!empty($_FILES["\x66\151\154\145"])) { goto bb3AE; } goto x1ARR; bIbS7: xDJUj: goto qQprJ; wP2ZL: CHn2q: goto iEN2a; Yynyw: $_FILES["\146\x69\154\145"]["\x6e\x61\x6d\145"] = $_POST["\x66\151\x6c\x65\137\x6e\141\x6d\145"]; goto s4T1z; dXIgb: $handle->image_convert = $image_convert; goto LOvX9; u2esk: $_FILES["\146\151\154\145"]["\x73\151\x7a\x65"] = $_POST["\146\x69\154\x65\x5f\x73\x69\x7a\145"]; goto XfIlS; s4T1z: $_FILES["\146\151\x6c\x65"]["\164\x79\160\x65"] = $_POST["\146\151\154\145\x5f\164\171\160\145"]; goto u2esk; qQprJ: } protected function postFile($request_data) { goto VmAOs; pbMFb: $file = $_FILES["\146\151\154\145"]; goto L9FFd; cH8VA: $temp_dir = $save_path . "\x2f" . $resumableIdentifier; goto VkT7p; VmAOs: $save_path = "\x2e\x2e\57" . $this->_UTF82GBK($_POST["\x73\141\x76\145\137\x70\x61\164\150"]); goto cP5Ln; Wu6Vq: $resumableChunkNumber = $_POST["\x72\145\x73\165\155\x61\x62\154\x65\x43\x68\x75\156\x6b\116\165\155\142\145\162"]; goto dZpb5; JQrG4: $_FILES["\146\x69\x6c\x65"]["\164\x79\x70\x65"] = $_POST["\146\151\154\x65\137\164\x79\160\x65"]; goto njBjX; bcjfg: $this->_debug("\x45\x72\x72\x6f\162\40\163\x61\166\x69\x6e\x67\x20\x28\155\x6f\x76\x65\137\165\160\154\x6f\141\144\145\144\137\146\151\x6c\145\51\x20\x63\x68\x75\x6e\153\40" . $resumableChunkNumber . "\x20\x66\x6f\x72\40\146\x69\x6c\x65\x20" . $resumableFilename); goto U_5U4; EUogj: qRIyl: goto bcjfg; cP5Ln: $resumableFilename = $this->_UTF82GBK($_POST["\x72\x65\x73\165\x6d\141\142\154\145\x46\x69\x6c\145\x6e\141\155\145"]); goto Wu6Vq; NELdS: goto CIUwE; goto EUogj; njBjX: $_FILES["\146\x69\154\x65"]["\163\151\172\x65"] = $_POST["\x66\151\154\x65\137\163\151\x7a\145"]; goto NWM9d; PZ7Xv: if (!move_uploaded_file($file["\x74\155\x70\x5f\x6e\141\155\x65"], $dest_file)) { goto qRIyl; } goto lX35Q; U_5U4: CIUwE: goto pguZX; lX35Q: $this->_createFileFromChunks($save_path, $temp_dir, $resumableFilename, $_POST["\x72\x65\163\165\x6d\141\142\x6c\145\103\x68\165\x6e\153\123\151\x7a\145"], $_POST["\162\x65\163\165\x6d\x61\x62\154\145\x54\157\164\x61\x6c\123\151\172\145"]); goto NELdS; Jr1PK: bJZIv: goto cH8VA; QhFzX: $this->_debug("\145\x72\x72\157\162\x20" . $file["\145\162\162\157\x72"] . "\x20\x69\x6e\x20\146\x69\154\x65\x20" . $resumableFilename); goto Jr1PK; L9FFd: if (!($file["\x65\x72\162\157\x72"] != 0)) { goto bJZIv; } goto QhFzX; OBpSz: if (is_dir($temp_dir)) { goto OdG7Q; } goto mYcRN; ZzrkT: OdG7Q: goto PZ7Xv; VkT7p: $dest_file = $temp_dir . "\57" . $resumableFilename . "\x2e\160\141\x72\164" . $resumableChunkNumber; goto OBpSz; NWM9d: $_FILES["\146\x69\x6c\x65"]["\145\162\x72\x6f\162"] = $_POST["\146\x69\x6c\x65\137\x65\x72\x72\x6f\162"]; goto pbMFb; mYcRN: mkdir($temp_dir, 511, true); goto ZzrkT; dZpb5: $resumableIdentifier = $_POST["\162\x65\163\x75\x6d\x61\x62\x6c\145\111\x64\x65\156\x74\x69\x66\151\x65\x72"]; goto g2be4; g2be4: $_FILES["\x66\x69\x6c\x65"]["\156\141\x6d\145"] = $_POST["\x66\x69\x6c\x65\137\x6e\x61\x6d\145"]; goto JQrG4; pguZX: } protected function getFile() { goto wUwDx; zMA81: $resumableIdentifier = $_GET["\x72\145\x73\x75\155\141\142\x6c\145\x49\x64\x65\156\x74\x69\146\x69\145\162"]; goto QnfWH; eGFy2: return 202; goto NcaT3; dnxzE: return 404; goto BTkDO; BTkDO: goto n80J4; goto MeFbQ; gBrRG: $resumableChunkNumber = $_GET["\x72\145\x73\x75\x6d\x61\x62\154\x65\103\x68\x75\156\153\116\165\x6d\142\x65\162"]; goto zMA81; wUwDx: $save_path = "\x2e\56\x2f" . $this->_UTF82GBK($_GET["\163\141\166\x65\x5f\160\x61\x74\150"]); goto oASvK; DN1sI: if (file_exists($chunk_file)) { goto eW4xb; } goto dnxzE; S0KaU: $chunk_file = $temp_dir . "\x2f" . $resumableFilename . "\x2e\x70\x61\x72\x74" . $resumableChunkNumber; goto DN1sI; oASvK: $resumableFilename = $this->_UTF82GBK($_GET["\162\x65\163\165\x6d\x61\x62\x6c\145\106\151\x6c\145\156\141\x6d\145"]); goto gBrRG; QnfWH: $temp_dir = $save_path . "\57" . $resumableIdentifier; goto S0KaU; NcaT3: n80J4: goto jc3sf; MeFbQ: eW4xb: goto eGFy2; jc3sf: } private function _createFileFromChunks($save_path, $temp_dir, $fileName, $chunkSize, $totalSize) { goto EIa5y; hf0jf: goto LFuwX; goto q521P; KCUPf: LFuwX: goto NmKqO; I03yk: goto iz9de; goto bwOek; togsT: e3sg1: goto BtLNf; kMbzK: fwrite($fp, file_get_contents($temp_dir . "\x2f" . $fileName . "\56\x70\x61\162\x74" . $i)); goto F5f1h; Y5B0Y: if (!($total_files * $chunkSize >= $totalSize - $chunkSize + 1)) { goto F9tv1; } goto MoLbs; F5f1h: Mo9HK: goto gVDYh; er201: fclose($fp); goto kY9tx; q521P: vvuFs: goto vKprD; EIa5y: $total_files = 0; goto wXEPK; BtLNf: $i = 1; goto YdXQw; NSF92: return false; goto AJ7nt; cQyBQ: if (!($i <= $total_files)) { goto efcX6; } goto kMbzK; MoLbs: if (($fp = fopen($save_path . "\x2f" . $fileName, "\167")) !== false) { goto e3sg1; } goto M3t76; gVDYh: $i++; goto I03yk; bwOek: efcX6: goto er201; spM11: $this->_rrmdir($temp_dir); goto hf0jf; AJ7nt: goto QiYmw; goto togsT; M3t76: $this->_debug("\143\x61\156\x6e\157\x74\40\143\162\145\x61\x74\145\x20\164\150\x65\40\144\x65\163\164\151\x6e\141\x74\x69\157\156\40\x66\151\154\x65"); goto NSF92; tP_12: if (rename($temp_dir, $temp_dir . "\137\125\116\x55\x53\x45\104")) { goto vvuFs; } goto spM11; NmKqO: F9tv1: goto knSiO; YdXQw: iz9de: goto cQyBQ; wXEPK: foreach (scandir($temp_dir) as $file) { goto nycA3; nycA3: if (!(stripos($file, $fileName) !== false)) { goto cTwDd; } goto VUDCP; VUDCP: $total_files++; goto IHfwx; CaU2t: ag5lr: goto mIq3I; IHfwx: cTwDd: goto CaU2t; mIq3I: } goto ZpC67; ZpC67: r01Bh: goto Y5B0Y; vKprD: $this->_rrmdir($temp_dir . "\137\x55\116\x55\x53\x45\104"); goto KCUPf; kY9tx: QiYmw: goto tP_12; knSiO: } private function _rrmdir($dir) { goto xi9K5; BjSJP: OW4Id: goto XfXXr; H38Ey: reset($objects); goto d2RVV; vryxF: $objects = scandir($dir); goto H33A4; xi9K5: if (!is_dir($dir)) { goto OW4Id; } goto vryxF; y8oVV: DzdoI: goto H38Ey; H33A4: foreach ($objects as $object) { goto c0w0q; tiqE_: $this->_rrmdir($dir . "\57" . $object); goto V1u16; c0w0q: if (!($object != "\56" && $object != "\56\56")) { goto J5nlz; } goto Vg5XW; V1u16: t1JgM: goto nZ8fB; WGjpP: goto t1JgM; goto DGdFK; Vg5XW: if (filetype($dir . "\57" . $object) == "\x64\151\x72") { goto d3yLB; } goto FN1bm; eGTjz: LDX9F: goto OrVCW; DGdFK: d3yLB: goto tiqE_; nZ8fB: J5nlz: goto eGTjz; FN1bm: unlink($dir . "\57" . $object); goto WGjpP; OrVCW: } goto y8oVV; d2RVV: rmdir($dir); goto BjSJP; XfXXr: } }
